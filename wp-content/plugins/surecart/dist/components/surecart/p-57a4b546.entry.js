import{r as i,h as t,F as o,a as e}from"./p-e97fde0a.js";import{g as s}from"./p-2c73bc7c.js";import{u as n,s as l,o as r}from"./p-97f59651.js";import{g as a}from"./p-93127aa7.js";import{u as d,a as c}from"./p-2cdfd4bc.js";import{c as v}from"./p-1f60f497.js";import{i as u,a as p}from"./p-e2d5dc4f.js";import"./p-07b1b1ed.js";import"./p-03631502.js";import"./p-d3366af3.js";import"./p-401e165e.js";import"./p-830ab1a3.js";import"./p-ec182234.js";import"./p-3f6362a4.js";import"./p-15630c79.js";import"./p-6ec14893.js";import"./p-9a298389.js";const h="sc-checkout-product-price-variant-selector{display:block}.sc-checkout-product-price-variant-selector{position:relative}.sc-checkout-product-price-variant-selector>*:not(:last-child){display:block;margin-bottom:var(--sc-form-row-spacing, 0.75em)}.sc-checkout-product-price-variant-selector__pills-wrapper{display:flex;flex-wrap:wrap;gap:var(--sc-spacing-x-small)}.sc-checkout-product-price-variant-selector__hidden-input{position:absolute !important;top:0 !important;left:0 !important;opacity:0 !important;padding:0px !important;margin:0px !important;pointer-events:none !important;width:0 !important}";const f=h;const m=class{constructor(t){i(this,t);this.product=undefined;this.label=undefined;this.selectorTitle=undefined;this.selectedVariant=undefined;this.selectedPrice=undefined;this.option1=undefined;this.option2=undefined;this.option3=undefined}handleOptionChange(){var i,t;this.selectedVariant=a({variants:(t=(i=this.product)===null||i===void 0?void 0:i.variants)===null||t===void 0?void 0:t.data,values:{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}}})}isSelectedVariantOutOfStock(){var i,t;return((i=this.product)===null||i===void 0?void 0:i.stock_enabled)&&this.hasVariants()&&!((t=this.product)===null||t===void 0?void 0:t.allow_out_of_stock_purchases)&&this.selectedVariant.available_stock<1}hasRequiredSelectedVariant(){var i;if(!this.hasVariants()){return true}return(i=this.selectedVariant)===null||i===void 0?void 0:i.id}async reportValidity(){this.input.setCustomValidity("");if(!this.hasVariants()){return this.input.reportValidity()}if(!this.hasRequiredSelectedVariant()){this.input.setCustomValidity(wp.i18n.__("Please choose an available option.","surecart"));return this.input.reportValidity()}if(this.isSelectedVariantOutOfStock()){this.input.setCustomValidity(wp.i18n.__("This selection is not available.","surecart"));return this.input.reportValidity()}return this.input.reportValidity()}getSelectedPrice(){var i,t,o,e,s;if(((o=(t=(i=this.product)===null||i===void 0?void 0:i.prices)===null||t===void 0?void 0:t.data)===null||o===void 0?void 0:o.length)===1){return(s=(e=this.product)===null||e===void 0?void 0:e.prices)===null||s===void 0?void 0:s.data[0]}return this.selectedPrice}async updateLineItems(){var i,t,o,e,s;const r=this.getSelectedPrice();if(!(r===null||r===void 0?void 0:r.id))return;const a=this.lineItem();if(((i=a===null||a===void 0?void 0:a.price)===null||i===void 0?void 0:i.id)===(r===null||r===void 0?void 0:r.id)&&((t=a===null||a===void 0?void 0:a.variant)===null||t===void 0?void 0:t.id)===((o=this.selectedVariant)===null||o===void 0?void 0:o.id))return;if(!this.hasRequiredSelectedVariant())return;if(this.isSelectedVariantOutOfStock())return;try{n("FETCH");if(a===null||a===void 0?void 0:a.id){l.checkout=await d({id:a===null||a===void 0?void 0:a.id,data:{variant:(e=this.selectedVariant)===null||e===void 0?void 0:e.id,price:r===null||r===void 0?void 0:r.id,quantity:1}})}else{l.checkout=await c({checkout:l.checkout,data:{variant:(s=this.selectedVariant)===null||s===void 0?void 0:s.id,price:r===null||r===void 0?void 0:r.id,quantity:1}})}n("RESOLVE")}catch(i){console.error(i);v(i);n("REJECT")}}componentWillLoad(){this.removeListener=r("checkout",(()=>{var i,t,o;const e=this.lineItem();this.selectedVariant=e===null||e===void 0?void 0:e.variant;this.selectedPrice=e===null||e===void 0?void 0:e.price;this.option1=(i=e===null||e===void 0?void 0:e.variant)===null||i===void 0?void 0:i.option_1;this.option2=(t=e===null||e===void 0?void 0:e.variant)===null||t===void 0?void 0:t.option_2;this.option3=(o=e===null||e===void 0?void 0:e.variant)===null||o===void 0?void 0:o.option_3}))}disconnectedCallback(){this.removeListener()}lineItem(){var i;return s((i=this.product)===null||i===void 0?void 0:i.id)}hasVariants(){var i,t,o;return((o=(t=(i=this.product)===null||i===void 0?void 0:i.variants)===null||t===void 0?void 0:t.data)===null||o===void 0?void 0:o.length)>0}render(){var i,e,s,n,l;return t("sc-form-control",{key:"74f2ab18025f2d4c607b832818ad8a566b6c6051",class:"sc-checkout-product-price-variant-selector",label:this.selectorTitle},(this.product.variant_options.data||[]).map((({name:i,values:e},s)=>t("sc-form-control",{label:i},t("div",{class:"sc-checkout-product-price-variant-selector__pills-wrapper"},(e||[]).map((e=>{const n=[s+1,e,{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}},this.product];const l=u.apply(void 0,n)||p.apply(void 0,n);return t("sc-pill-option",{isUnavailable:l,isSelected:this[`option${s+1}`]===e,onClick:()=>this[`option${s+1}`]=e},t("span",{"aria-hidden":"true"},e),t("sc-visually-hidden",null,wp.i18n.sprintf(wp.i18n.__("Select %s: %s","surecart"),i,e),l&&t(o,null," ",wp.i18n.__("(option unavailable)","surecart"))))})))))),((s=(e=(i=this.product)===null||i===void 0?void 0:i.prices)===null||e===void 0?void 0:e.data)===null||s===void 0?void 0:s.length)>1&&t("sc-form-control",{key:"83e5beeaae1f7213af10131ab5a3087688c54002",label:!!((n=this.product.variant_options.data)===null||n===void 0?void 0:n.length)?this.label:null},t("sc-choices",{key:"c84eb423473a4cafd097718c7577166f9f72f31c"},(this.product.prices.data||[]).sort(((i,t)=>(i===null||i===void 0?void 0:i.position)-(t===null||t===void 0?void 0:t.position))).map((i=>{var o,e,s;return t("sc-price-choice-container",{required:true,price:i,label:(i===null||i===void 0?void 0:i.name)||((o=this.product)===null||o===void 0?void 0:o.name),checked:((s=(e=this.lineItem())===null||e===void 0?void 0:e.price)===null||s===void 0?void 0:s.id)===(i===null||i===void 0?void 0:i.id),onScChange:t=>{if(t.target.checked){this.selectedPrice=i}}})})))),t("input",{key:"fd9b4567e3423a4308ff42a31789ff02422fc4ba",class:"sc-checkout-product-price-variant-selector__hidden-input",ref:i=>this.input=i,value:(l=this.selectedVariant)===null||l===void 0?void 0:l.id}))}get el(){return e(this)}static get watchers(){return{option1:["handleOptionChange"],option2:["handleOptionChange"],option3:["handleOptionChange"],selectedVariant:["updateLineItems"],selectedPrice:["updateLineItems"]}}};m.style=f;export{m as sc_checkout_product_price_variant_selector};
//# sourceMappingURL=p-57a4b546.entry.js.map