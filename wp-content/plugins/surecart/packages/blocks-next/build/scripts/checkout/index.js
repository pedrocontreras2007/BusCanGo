import*as e from"@wordpress/interactivity";import*as t from"@surecart/checkout-service";import*as o from"@surecart/checkout-events";var n,r,i={d:function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},c=(n={getContext:function(){return e.getContext},getElement:function(){return e.getElement},store:function(){return e.store}},r={},i.d(r,n),r),u=function(e){var t={};return i.d(t,e),t}({handleCouponApply:function(){return t.handleCouponApply},removeCheckoutLineItem:function(){return t.removeCheckoutLineItem},updateCheckoutLineItem:function(){return t.updateCheckoutLineItem}}),s=function(e){var t={};return i.d(t,e),t}({processCheckoutEvents:function(){return o.processCheckoutEvents}});const{__,sprintf:a,_n}=wp.i18n,{speak:l}=wp.a11y,d="surecart-local-storage",m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"live",t=arguments.length>1?arguments[1]:void 0;const o=localStorage.getItem(d),n={live:{},test:{}},r=(JSON.parse(o)||n)[e];return r?.[t]||n},p=e=>"keydown"===e.type&&"Enter"!==e.key&&"Space"!==e.code,g=e=>{const t=document.querySelector?.(e)||null;t&&setTimeout((()=>{t.focus()}),0)},{state:C,actions:h}=(0,c.store)("surecart/checkout",{state:{loading:!1,error:null,promotionCode:"",checkout:{},oldCheckout:{},get itemsCount(){return C.checkout?.line_items_count||0},get hasItems(){return C.itemsCount>0},get discountIsRedeemable(){return"redeemable"===C?.checkout?.discount?.redeemable_status},get lineItemHasScratchAmount(){const{line_item:e}=(0,c.getContext)();return!e?.ad_hoc_amount&&e.price.scratchAmount!==e.price.amount},get isDiscountApplied(){return!!C?.checkout?.discount?.promotion?.code},get checkoutLineItems(){return C.checkout?.line_items?.data||[]},get isEditable(){const{line_item:e}=(0,c.getContext)();return!e?.price?.ad_hoc&&!e?.bump_amount},get hasSubscription(){return(C.checkout?.line_items?.data||[]).some((e=>"month"===e?.price?.recurring_interval&&!!e?.price?.recurring_interval&&!e?.price?.recurring_period_count))},get hasRecurring(){return C?.checkout?.line_items?.data?.some((e=>e?.price?.recurring_interval))},get errorTitle(){return C.error?.title||C.error||""},get errorMessage(){return C.error?.message||""},get lineItemPermalink(){const{line_item:e}=(0,c.getContext)(),t=e?.price?.product;return t?.is_published?t?.permalink:null},get additionalErrors(){return(C?.error?.additional_errors||[]).map((e=>e.message))},get showCartMenuIcon(){const{cartMenuAlwaysShown:e}=(0,c.getContext)();return C.itemsCount>0||e},get itemsCountAriaLabel(){const e=C.itemsCount;return a(_n(/* translators: %d: number of items in the cart */
"Total of %d item in the cart","Total of %d items in the cart",e,"surecart"),e)},get lineItemVariant(){const{line_item:e}=(0,c.getContext)();return(e?.variant_options||[]).filter(Boolean).join(" / ")||null}},callbacks:{getState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?(0,c.getContext)():(0,c.getContext)()?.[e]||!1},init(){const{mode:e,formId:t}=(0,c.getContext)(),o=m(e,t);h.setCheckout(o,e,t)},syncTabs(e){if(e?.key!==d)return;const{mode:t,formId:o}=(0,c.getContext)(),n=m(t,o);h.setCheckout(n,t,o)},onChangeCheckout(){const{checkout:e,oldCheckout:t}=C;(0,s.processCheckoutEvents)(e,t)}},actions:{toggleDiscountInput(e){if(p(e))return!0;e.preventDefault();const t=(0,c.getContext)();t.discountInputOpen=!t.discountInputOpen;const{ref:o}=(0,c.getElement)(),n=o?.parentElement?.querySelector?.("input");n&&setTimeout((()=>n.focus()),0)},setPromotionCode(e){C.promotionCode=e?.target?.value||""},maybeApplyDiscountOnKeyChange(e){if("Escape"!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation()),"Escape"===e.key)return(0,c.getContext)().discountInputOpen=!1,void g("#sc-coupon-trigger");"Enter"===e.key&&h.applyDiscount(e),h.setPromotionCode(e)},applyDiscount:async e=>{if(e.preventDefault(),e.stopPropagation(),!C.promotionCode)return;const{mode:t,formId:o}=(0,c.getContext)();l(__("Applying promotion code.","surecart"),"assertive");const n=await(0,u.handleCouponApply)(C.promotionCode);n&&(l(a(/* translators: %s: promotion code */
__("Promotion code %s has been applied.","surecart"),C.promotionCode),"assertive"),C.error="",h.setCheckout(n,t,o),g("#sc-coupon-remove-discount"))},removeDiscount:async()=>{const e=(0,c.getContext)(),{mode:t,formId:o}=e;l(__("Removing promotion code.","surecart"),"assertive");const n=await(0,u.handleCouponApply)(null);n&&(C.promotionCode="",e.discountInputOpen=!1,h.setCheckout(n,t,o),l(__("Promotion code has been removed.","surecart"),"assertive"),g("#sc-coupon-trigger"))},closeCouponOnClickOutside:e=>{const t=(0,c.getContext)();e&&e.target.closest(".sc-coupon-form")||t.discountInputOpen&&(t.discountInputOpen=!1)},setCheckout(e,t,o){let n=m(t,o);if(!n)return;C.oldCheckout=n;let r=JSON.parse(localStorage.getItem(d));r||(r={live:{},test:{}}),t&&e?.live_mode===("live"===t)&&(r={...r,[t]:{...r[t],[o]:e}},localStorage.setItem(d,JSON.stringify(r)),C.checkout=m(t,o))},onQuantityIncrease:async e=>{if(p(e))return!0;const{line_item:t}=(0,c.getContext)(),o=t?.quantity+1;await h.updateLineItem({quantity:o}),l(a(/* translators: %d: quantity */
__("Quantity increased to %d.","surecart"),o),"assertive")},onQuantityDecrease:async e=>{if(p(e))return!0;const{line_item:t}=(0,c.getContext)(),o=t?.quantity-1;o<1||(await h.updateLineItem({quantity:o}),l(a(/* translators: %d: quantity */
__("Quantity decreased to %d.","surecart"),o),"assertive"))},onQuantityChange:async e=>{const t=parseInt(e.target.value||"");await h.updateLineItem({quantity:t}),l(a(/* translators: %d: quantity */
__("Quantity changed to %d.","surecart"),t),"assertive")},updateLineItem:async e=>{C.loading=!0;const{line_item:t,mode:o,formId:n}=(0,c.getContext)(),r=await(0,u.updateCheckoutLineItem)({id:t?.id,data:e});h.setCheckout(r,o,n),C.loading=!1},removeLineItem:function*(){C.loading=!0;const{line_item:e,mode:t,formId:o}=(0,c.getContext)();l(__("Removing line item.","surecart"),"assertive");const n=yield*(0,u.removeCheckoutLineItem)(e?.id);h.setCheckout(n,t,o),C.loading=!1},updateCheckout(e){const{checkout:t,mode:o,formId:n}=e.detail;h.setCheckout(t,o,n)}}});addEventListener("scCheckoutUpdated",(e=>{document.querySelector("sc-checkout")||h.updateCheckout(e)}));