async function getUniqueValidationData(r,e,t,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(e);Object.keys(r).forEach(e=>{o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(r[e])});try{var i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(i.ok)return(await i.json()).data}catch(e){console.error(e)}}async function fieldValidation(e,r,t,s,o=!1){let l=!1,i=null,a=null,n={};const c=(e,r,t={})=>{i||(i=e,a=r,n=t)};let m=null;var u=document.querySelectorAll('input[data-unique="true"]');if(0!==u.length){var d={};for(const S of u){var f=S.name,b=S.value;d[f]=b}m=await getUniqueValidationData(d,e,r,t)}for(const E of o?[s]:Array.from(s.querySelectorAll(".srfm-block-single"))){let r=!1;if(Array.isArray(window.sureforms?.skipValidationCallbacks)&&window.sureforms.skipValidationCallbacks.forEach(e=>{"function"==typeof e&&(r=r||e(E))}),!r){var p=E.closest("form").getAttribute("form-id");if(p===e){const x=E.querySelector("input, textarea, select");var p=x.getAttribute("data-required"),L=x.getAttribute("data-unique");let r=x.getAttribute("name");var v,y,k,g=x.value;const C=E.querySelector(".srfm-error-message");if(r=r&&r.replace(/_/g," "),p&&"hidden"!==x.type&&("true"!==p||g?x&&x.closest(".srfm-block").classList.remove("srfm-error"):(x&&x.closest(".srfm-block").classList.add("srfm-error"),C&&(C.textContent=C.getAttribute("data-error-msg")),l=!0,c(x,x.closest(".srfm-block"))),x.addEventListener("input",()=>{x.closest(".srfm-block").classList.remove("srfm-error")})),"true"===L&&""!==g&&(m?.some(e=>"not unique"===e[r])?(x&&x.closest(".srfm-block").classList.add("srfm-error"),C.style.display="block",C.textContent=C.getAttribute("data-unique-msg"),l=!0,c(x,x.closest(".srfm-block"))):x&&(x.closest(".srfm-block").classList.remove("srfm-error"),C.style.display="none")),E.classList.contains("srfm-multi-choice-block")||E.classList.contains("srfm-checkbox-block")||E.classList.contains("srfm-gdpr-block")){var q=E.querySelectorAll("input"),L=q[0].getAttribute("data-required");let r=!1,t=null;for(let e=0;e<q.length;e++)if(t||"hidden"===q[e].type||(t=q[e]),q[e].checked){r=!0;break}"true"!==L||r?C&&E.classList.remove("srfm-error"):(C&&(C.textContent=E.querySelector(".srfm-error-message").getAttribute("data-error-msg"),E.classList.add("srfm-error")),l=!0,c(t,E)),q.forEach(e=>{e.addEventListener("input",()=>{E.classList.remove("srfm-error")})})}if(E.classList.contains("srfm-url-block")&&(L=E.querySelector("input"),E.classList.contains("srfm-url-error")&&(E.classList.add("srfm-error"),l=!0,c(L,E)),L.addEventListener("input",()=>{E.classList.remove("srfm-error")})),E.classList.contains("srfm-phone-block")&&(L=E.querySelectorAll("input")[1],E.classList.contains("srfm-phone-error")&&(E.classList.add("srfm-error"),l=!0,c(L,E)),E.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>{E.classList.remove("srfm-error")})})),E.classList.contains("srfm-password-block-wrap")&&(L=E)&&(L=L.querySelector(".srfm-password-confirm-block"))&&(y=L.querySelector(".srfm-input-password-confirm").value,v=L.querySelector(".srfm-error-message"),!y&&v&&"true"===p?(v.textContent=v.getAttribute("data-error-msg"),L.classList.add("srfm-error"),c(y,L),l=!0):y!==g?(L.classList.add("srfm-error"),v.textContent="Confirmation Password is not the same",c(y,L),l=!0):L.classList.remove("srfm-error")),E.classList.contains("srfm-email-block-wrap")){const I=E;if(I){const V=I.querySelector(".srfm-email-confirm-block");I.classList.contains("srfm-valid-email-error")&&(c(x,I),l=!0),V&&(v=V.querySelector(".srfm-input-email-confirm"),y=V.querySelector(".srfm-input-email-confirm").value,L=V.querySelector(".srfm-error-message"),!y&&L&&"true"===p?(L.textContent=L.getAttribute("data-error-msg"),V.classList.add("srfm-error"),c(v,V),l=!0):y!==g?(V.classList.add("srfm-error"),L.textContent="Confirmation email is not the same",c(v,V),l=!0):V.classList.remove("srfm-error"),v.addEventListener("input",()=>{V.classList.remove("srfm-error")})),I.querySelector(".srfm-input-email").addEventListener("input",()=>{I.classList.remove("srfm-error")})}}if(E.classList.contains("srfm-upload-block")&&("true"!==(k=(L=E.querySelector(".srfm-input-upload")).getAttribute("data-required"))||L.value?x&&x.closest(".srfm-block").classList.remove("srfm-error"):("true"===k&&C&&(C.textContent=C.getAttribute("data-error-msg")),x&&x.closest(".srfm-block").classList.add("srfm-error"),l=!0,c(L,E)),L.addEventListener("input",()=>{x&&x.closest(".srfm-block").classList.remove("srfm-error")})),E.classList.contains("srfm-number-block")&&(k=x.getAttribute("min"),L=x.getAttribute("max"),w=x.getAttribute("format-type"),g)&&(w="eu-style"===w?parseFloat(g.replace(/\./g,"").replace(",",".")):parseFloat(g.replace(/,/g,"")),k&&(""!==k&&Number(w)<Number(k)?(x.closest(".srfm-block").classList.add("srfm-error"),C&&(C.textContent="Minimum value is "+k)):x.closest(".srfm-block").classList.remove("srfm-error")),L)&&(""!==L&&Number(w)>Number(L)?(x.closest(".srfm-block").classList.add("srfm-error"),C&&(C.textContent="Maximum value is "+L)):x.closest(".srfm-block").classList.remove("srfm-error")),E.classList.contains("srfm-rating-block")&&("true"!==(g=E.querySelector(".srfm-input-rating")).getAttribute("data-required")||g.value?g.closest(".srfm-block").classList.remove("srfm-error"):(g.closest(".srfm-block").classList.add("srfm-error"),l=!0,c(E.querySelector(".srfm-icon"),E))),E.classList.contains("srfm-slider-block")){var w=E.getAttribute("data-required"),L=E.querySelector(".srfm-input-slider"),g=E.querySelector(".srfm-text-slider"),h=E.getAttribute("data-default");if("true"===w){let e=!1;(e=(!L||L.dataset.interacted||h&&"false"!==h)&&(!g||g.dataset.interacted||h&&"false"!==h)?e:!0)?(E.classList.add("srfm-error"),l=!0,c(L,E)):E.classList.remove("srfm-error")}}if(E.classList.contains("srfm-dropdown-block")){g=E.querySelectorAll(".srfm-input-dropdown-hidden");const M=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;g.forEach(e=>{const r=e.getAttribute("data-required");var t,s,o,i=e.getAttribute("name");"true"!==r||e.value?e.value?(o=e.getAttribute("data-min-selection"),t=e.getAttribute("data-max-selection"),(o||t)&&(s=e.value.split(","),o&&s.length<o?(C.textContent=wp.i18n.sprintf(wp.i18n.__("Minimum %d selections are required","sureforms"),o),e.closest(".srfm-block").classList.add("srfm-error"),l=!0):t&&s.length>t&&(C.textContent=wp.i18n.sprintf(wp.i18n.__("Maximum %d selections are allowed","sureforms"),t),e.closest(".srfm-block").classList.add("srfm-error"),l=!0))):e.closest(".srfm-block").classList.remove("srfm-error"):(C.textContent=C.getAttribute("data-error-msg"),e.closest(".srfm-block").classList.add("srfm-error"),l=!0),l&&(o=window?.srfm?.[i]||e,c(o,e.closest(".srfm-block"),{shouldDelayOnFocus:!0})),new M(()=>{e.value?e.closest(".srfm-block").classList.remove("srfm-error"):"true"===r&&e.closest(".srfm-block").classList.add("srfm-error")}).observe(e,{attributes:!0,attributeFilter:["value"]})})}if(E.classList.contains("srfm-multi-choice-block")){var A=E.querySelectorAll("input"),h=A[0].getAttribute("data-min-selection"),L=A[0].getAttribute("data-max-selection");let r=null,t=0,e=!1;for(let e=0;e<A.length;e++)r||"hidden"===A[e].type||(r=A[e]),A[e].checked&&t++;(h||L)&&0<t&&(!e&&0<h&&(p&&1<h||!p)&&t<h&&(C.textContent=wp.i18n.sprintf(wp.i18n.__("Minimum %d selections are required","sureforms"),h),e=!0),!e&&0<L&&t>L&&(C.textContent=wp.i18n.sprintf(wp.i18n.__("Maximum %d selections are allowed","sureforms"),L),e=!0),e?(E.classList.add("srfm-error"),c(r,E),l=!0):p||E.classList.remove("srfm-error"))}}}}return!!l&&{validateResult:l,firstErrorInput:i,scrollElement:a,...n}}function initializeInlineFieldValidation(){["srfm-input-block","srfm-email-block-wrap","srfm-url-block","srfm-phone-block","srfm-checkbox-block","srfm-gdpr-block","srfm-number-block","srfm-multi-choice-block","srfm-datepicker-block","srfm-upload-block","srfm-rating-block","srfm-textarea-block","srfm-dropdown-block","srfm-slider-block"].forEach(e=>addBlurListener(e,"."+e))}function addBlurListener(r,t){var e=Array.from(document.getElementsByClassName(r));if(e)for(const s of e){let e=s.querySelector("input")||s.querySelector("textarea")||s.querySelector("select");if("srfm-upload-block"===r&&(e=s.querySelector('input[type="file"]')),"srfm-rating-block"===r&&addRatingBlurListener(e,s,t),"srfm-multi-choice-block"===r&&addMultiChoiceBlurListener(e,s,t),"srfm-email-block-wrap"===r&&addEmailBlurListener(s,t),"srfm-slider-block"===r&&addSliderBlurListener(e,s,t),"srfm-dropdown-block"===r){const o=e.getAttribute("name");setTimeout(()=>{window?.srfm?.[o]?.on("blur",function(){fieldValidationInit(e,t)})},500)}e&&e.addEventListener("blur",async function(){fieldValidationInit(e,t)})}}function addRatingBlurListener(t,e,s){(t=e.querySelectorAll(".srfm-icon")).forEach((e,r)=>{r===t.length-1&&e.addEventListener("blur",async function(){fieldValidationInit(e,s)})})}function addMultiChoiceBlurListener(e,r,t){r.querySelectorAll(".srfm-input-multi-choice-single").forEach(e=>{e.addEventListener("blur",async function(){fieldValidationInit(e,t)})})}function addEmailBlurListener(e,r){var t=e.querySelectorAll("input");const l=e.closest(r);t.forEach(i=>{i.addEventListener("input",async function(){i.value=i.value.trim().toLowerCase();let e=!1;/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value)&&(e=!0);var r=i.classList.contains("srfm-input-email-confirm")?l.querySelector(".srfm-email-confirm-block"):l.querySelector(".srfm-email-block"),t=r.querySelector(".srfm-error-message");if(i.value||(t.style.display="none",r.classList.remove("srfm-valid-email-error")),i.classList.contains("srfm-input-email-confirm")){var s=l.querySelector(".srfm-input-email"),o=l.querySelector(".srfm-email-confirm-block").querySelector(".srfm-error-message");if(s.value!==i.value)return o.style.display="block",o.textContent="Confirmation email is not the same",void l.classList.add("srfm-error");l.classList.remove("srfm-error"),o.textContent="",o.style.display="none"}e?(t.style.display="none",r.parentElement.classList.remove("srfm-valid-email-error")):(r.parentElement.classList.add("srfm-valid-email-error"),t.style.display="block",t.innerHTML="Please enter a valid email address")})})}function addSliderBlurListener(e,r,t){const s=r.querySelector(".srfm-input-slider");r=r.querySelector(".srfm-text-slider");if(s&&s.addEventListener("blur",async function(){fieldValidationInit(s,t)}),r){const o=r.querySelector(".srfm-slider-thumb");o&&o.addEventListener("blur",async function(){fieldValidationInit(o,t)})}}const fieldValidationInit=async(e,r)=>{e=e.closest(r),r=e.closest("form");await fieldValidation(r.getAttribute("form-id"),r.getAttribute("ajaxurl"),r.getAttribute("nonce"),e,!0)},handleScrollAndFocusOnError=e=>{var r,t,s;e?.firstErrorInput&&(e?.scrollElement&&(r=e.scrollElement.getBoundingClientRect().top,t=window.pageYOffset,s=window.innerHeight,window.scroll({top:r+t-s/2,behavior:"smooth"})),e?.shouldDelayOnFocus?setTimeout(()=>{e.firstErrorInput.focus({preventScroll:!0})},500):e.firstErrorInput.focus({preventScroll:!0}))};export{fieldValidation,initializeInlineFieldValidation,handleScrollAndFocusOnError};